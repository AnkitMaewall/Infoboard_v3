'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_Session=require('./Session'),_Session2=_interopRequireDefault(_Session),_ActivityManager=require('./managers/ActivityManager'),_ActivityManager2=_interopRequireDefault(_ActivityManager),_BackupsManager=require('./managers/BackupsManager'),_BackupsManager2=_interopRequireDefault(_BackupsManager),_BizInvitationsManager=require('./managers/BizInvitationsManager'),_BizInvitationsManager2=_interopRequireDefault(_BizInvitationsManager),_BusinessUsersManager=require('./managers/BusinessUsersManager'),_BusinessUsersManager2=_interopRequireDefault(_BusinessUsersManager),_CollaboratorsManager=require('./managers/CollaboratorsManager'),_CollaboratorsManager2=_interopRequireDefault(_CollaboratorsManager),_CollaboratorStatesManager=require('./managers/CollaboratorStatesManager'),_CollaboratorStatesManager2=_interopRequireDefault(_CollaboratorStatesManager),_CompletedManager=require('./managers/CompletedManager'),_CompletedManager2=_interopRequireDefault(_CompletedManager),_FiltersManager=require('./managers/FiltersManager'),_FiltersManager2=_interopRequireDefault(_FiltersManager),_InvitationsManager=require('./managers/InvitationsManager'),_InvitationsManager2=_interopRequireDefault(_InvitationsManager),_ItemsManager=require('./managers/ItemsManager'),_ItemsManager2=_interopRequireDefault(_ItemsManager),_LabelsManager=require('./managers/LabelsManager'),_LabelsManager2=_interopRequireDefault(_LabelsManager),_LiveNotificationsManager=require('./managers/LiveNotificationsManager'),_LiveNotificationsManager2=_interopRequireDefault(_LiveNotificationsManager),_LocationsManager=require('./managers/LocationsManager'),_LocationsManager2=_interopRequireDefault(_LocationsManager),_NotesManager=require('./managers/NotesManager'),_NotesManager2=_interopRequireDefault(_NotesManager),_ProjectNotesManager=require('./managers/ProjectNotesManager'),_ProjectNotesManager2=_interopRequireDefault(_ProjectNotesManager),_ProjectsManager=require('./managers/ProjectsManager'),_ProjectsManager2=_interopRequireDefault(_ProjectsManager),_RemindersManager=require('./managers/RemindersManager'),_RemindersManager2=_interopRequireDefault(_RemindersManager),_TemplatesManager=require('./managers/TemplatesManager'),_TemplatesManager2=_interopRequireDefault(_TemplatesManager),_UploadsManager=require('./managers/UploadsManager'),_UploadsManager2=_interopRequireDefault(_UploadsManager),_UserManager=require('./managers/UserManager'),_UserManager2=_interopRequireDefault(_UserManager),_Collaborator=require('./models/Collaborator'),_Collaborator2=_interopRequireDefault(_Collaborator),_CollaboratorState=require('./models/CollaboratorState'),_CollaboratorState2=_interopRequireDefault(_CollaboratorState),_Filter=require('./models/Filter'),_Filter2=_interopRequireDefault(_Filter),_Item=require('./models/Item'),_Item2=_interopRequireDefault(_Item),_Label=require('./models/Label'),_Label2=_interopRequireDefault(_Label),_LiveNotification=require('./models/LiveNotification'),_LiveNotification2=_interopRequireDefault(_LiveNotification),_Note=require('./models/Note'),_Note2=_interopRequireDefault(_Note),_Project=require('./models/Project'),_Project2=_interopRequireDefault(_Project),_ProjectNote=require('./models/ProjectNote'),_ProjectNote2=_interopRequireDefault(_ProjectNote),_Reminder=require('./models/Reminder'),_Reminder2=_interopRequireDefault(_Reminder),_uuid=require('./utils/uuid');Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function e(f,g){try{var h=b[f](g),j=h.value}catch(k){return void d(k)}return h.done?void c(j):Promise.resolve(j).then(function(k){e('next',k)},function(k){e('throw',k)})}return e('next')})}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}require('babel-polyfill');var API=function(){function a(b){_classCallCheck(this,a),this.api_endpoint='https://todoist.com',this.session=new _Session2.default({token:b}),this.queue=[],this.temp_ids={},this.projects=new _ProjectsManager2.default(this),this.project_notes=new _ProjectNotesManager2.default(this),this.items=new _ItemsManager2.default(this),this.labels=new _LabelsManager2.default(this),this.filters=new _FiltersManager2.default(this),this.notes=new _NotesManager2.default(this),this.live_notifications=new _LiveNotificationsManager2.default(this),this.reminders=new _RemindersManager2.default(this),this.locations=new _LocationsManager2.default(this),this.invitations=new _InvitationsManager2.default(this),this.biz_invitations=new _BizInvitationsManager2.default(this),this.user=new _UserManager2.default(this),this.collaborators=new _CollaboratorsManager2.default(this),this.collaborator_states=new _CollaboratorStatesManager2.default(this),this.completed=new _CompletedManager2.default(this),this.uploads=new _UploadsManager2.default(this),this.activity=new _ActivityManager2.default(this),this.business_users=new _BusinessUsersManager2.default(this),this.templates=new _TemplatesManager2.default(this),this.backups=new _BackupsManager2.default(this),this.state={collaborator_states:[],collaborators:[],day_orders:{},day_orders_timestamp:'',filters:[],items:[],labels:[],live_notifications:[],live_notifications_last_read_id:-1,locations:[],notes:[],project_notes:[],projects:[],reminders:[],settings_notifications:{},user:{}}}return _createClass(a,[{key:'get',value:function get(b,c){return this.session.get(this.get_api_url(b),c)}},{key:'post',value:function post(b,c,d){return this.session.post(this.get_api_url(b),c,d)}},{key:'sync',value:function(){var c=_asyncToGenerator(regeneratorRuntime.mark(function d(){var g,h,e=this,f=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return regeneratorRuntime.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,this.session.get(this.get_api_url('sync'),{day_orders_timestamp:this.state.day_orders_timestamp,include_notification_settings:1,resource_types:JSON.stringify(['all']),commands:JSON.stringify(f)});case 2:return g=k.sent,h=Object.keys(g.temp_id_mapping||{}),0<h.length&&h.forEach(function(l){var m=g.temp_id_mapping[l];e.temp_ids[l]=m,e.replace_temp_id(l,m)}),k.next=7,this.update_state(g);case 7:return k.abrupt('return',g);case 8:case'end':return k.stop();}},d,this)}));return function(){return c.apply(this,arguments)}}()},{key:'query',value:function query(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return this.session.get(this.get_api_url('query'),{queries:JSON.stringify(b)})}},{key:'update_state',value:function(){var c=_asyncToGenerator(regeneratorRuntime.mark(function d(e){var g,h,j,f=this;return regeneratorRuntime.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return g=['day_orders','day_orders_timestamp','live_notifications_last_read_id','locations','settings_notifications','user'],g.map(function(m){e[m]&&(f.state[m]=e[m])}),h={collaborator:_Collaborator2.default,collaborator_states:_CollaboratorState2.default,filters:_Filter2.default,items:_Item2.default,labels:_Label2.default,live_notifications:_LiveNotification2.default,notes:_Note2.default,project_notes:_ProjectNote2.default,projects:_Project2.default,reminders:_Reminder2.default},j=[],Object.keys(h).forEach(function(m){var n=(e[m]||[]).map(function(o){return Promise.resolve().then(_asyncToGenerator(regeneratorRuntime.mark(function p(){var q,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.find_object(m,o);case 2:q=t.sent,q?Object.assign(q.data,o):(r=new h[m](o,f),f.state[m].push(r));case 4:case'end':return t.stop();}},p,f)})))});j=[].concat(_toConsumableArray(j),_toConsumableArray(n))}),l.next=7,Promise.all(j);case 7:Object.keys(h).forEach(function(m){f.state[m]&&(f.state[m]=f.state[m].filter(function(n){return 1!==n.is_deleted}))});case 8:case'end':return l.stop();}},d,this)}));return function(){return c.apply(this,arguments)}}()},{key:'find_object',value:function find_object(b,c){return'collaborators'===b?this.collaborators.get_by_id(c.id):'collaborator_states'===b?this.collaborator_states.get_by_ids(c.project_id,c.user_id):'filters'===b?this.filters.get_by_id(c.id,!0):'items'===b?this.items.get_by_id(c.id,!0):'labels'===b?this.labels.get_by_id(c.id,!0):'live_notifications'===b?this.live_notifications.get_by_id(c.id):'notes'===b?this.notes.get_by_id(c.id,!0):'project_notes'===b?this.project_notes.get_by_id(c.id,!0):'projects'===b?this.projects.get_by_id(c.id,!0):'reminders'===b?this.reminders.get_by_id(c.id,!0):null}},{key:'replace_temp_id',value:function replace_temp_id(b,c){var d=this;['filters','items','labels','notes','project_notes','projects','reminders'].forEach(function(f){d.state[f].forEach(function(g,h){g.temp_id===b&&(d.state[f][h].id=c)})})}},{key:'generate_uuid',value:function generate_uuid(){return(0,_uuid.generate_uuid)()}},{key:'get_api_url',value:function get_api_url(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:'';return this.api_endpoint+'/API/v7/'+b}},{key:'add_item',value:function add_item(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return Object.assign(c,{content:b}),c.labels&&(c.labels=JSON.stringify(c.labels)),this.get('add_item',c)}},{key:'commit',value:function(){var c=_asyncToGenerator(regeneratorRuntime.mark(function d(){var f,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!0;return regeneratorRuntime.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(this.queue.length){h.next=2;break}return h.abrupt('return');case 2:return h.next=4,this.sync(this.queue);case 4:return f=h.sent,this.queue=[],f.sync_status&&e&&Object.keys(f.sync_status).forEach(function(j){if('ok'!=f.sync_status[j])throw new Error('sync fail ('+j+', '+JSON.stringify(f.sync_status[j])+')')}),h.abrupt('return',f);case 8:case'end':return h.stop();}},d,this)}));return function(){return c.apply(this,arguments)}}()}]),a}();exports.default=API;
//# sourceMappingURL=Api.js.map