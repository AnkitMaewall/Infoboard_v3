'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(exports,'__esModule',{value:!0});require('fetch-everywhere');var _uuid=require('./utils/uuid');function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var Session=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,a),this._app_token=b.app_token||'',this._client=b.client_id||'',this._scope=b.scope||'data:read_write,data:delete,project:delete',this._state=b.state||(0,_uuid.generate_uuid)(),this._secret=b.client_secret||'',this._token=b.token||'',this._sync_token='*',this._auth_url='https://todoist.com/oauth/authorize',this._exchange_token_url='https://todoist.com/oauth/access_token'}return _createClass(a,[{key:'config',value:function config(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._app_token=b.app_token||this._app_token,this._client=b.client_id||this._client,this._scope=b.scope||this._scope,this._state=b.state||this._state,this._secret=b.client_secret||this._secret}},{key:'requestAuthorizationUrl',value:function requestAuthorizationUrl(){var b=this._dataToQueryString({client_id:this._client,scope:this._scope,state:this._state});return this._auth_url+'?'+b}},{key:'getAccessToken',value:function getAccessToken(){return this.request(this._exchange_token_url,'POST',{client_id:this._client,client_secret:this._secret,code:this._code})}},{key:'get',value:function get(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.request(b,'GET',c)}},{key:'post',value:function post(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},d=arguments[2];return this.request(b,'POST',c,d)}},{key:'_dataToQueryString',value:function _dataToQueryString(b){return Object.keys(b).map(function(c){return encodeURIComponent(c)+'='+encodeURIComponent(b[c])}).join('&')}},{key:'request',value:function request(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'GET',d=this,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},f=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},g=Object.assign({},{Accept:'application/json, text/plain, */*','Content-Type':'text/plain'},f);this._token&&(e.token=this._token),'POST'===c&&(e.sync_token=this._sync_token);var h=this._dataToQueryString(e);return fetch(b+'?'+h,{method:c,headers:g,body:/GET|HEAD/.test(c)?null:JSON.stringify(e)}).then(function(l){if(l.error_code)throw new Error('(cod: '+l.error_code+') '+l.error);return l}).then(function(l){if(!l.ok)throw new Error('('+l.status+') '+l.statusText);return l}).then(function(l){return l.sync_token&&(d._sync_token=l.sync_token),/attachment/.test(l.headers.get('content-disposition'))?l:l.json()})}},{key:'accessToken',set:function set(b){this._token=b}},{key:'code',set:function set(b){this._code=b}}]),a}();exports.default=Session;
//# sourceMappingURL=Session.js.map